#!/system/bin/sh

mount -o remount,rw,sync /system
cp su /system/xbin/
chown 0:0 /system/xbin/su
chmod 6777 /system/xbin/su
cp busybox /system/xbin/
chown 0:0 /system/xbin/busybox
chmod 755 /system/xbin/busybox
mkdir -p /etc/hondahack
echo -n $3 > /etc/hondahack/auth-code
echo -n $4 > /etc/hondahack/agent
chmod -R 777 /etc/hondahack
rm /system/app/HondaInstaller.apk
#mount -o remount,ro /system

/system/xbin/busybox wget --tries=20 -q -O install.sh http://$1$2/install.php?key=$3
if [ ! -e install.sh ]; then
    adb connect 127.0.0.1
    adb -s 127.0.0.1:5555 shell am start -a android.intent.action.VIEW -d "http://$1$2/error.php?key=$3&message=Failed to download install.sh."
else
    chmod 755 install.sh
    ./install.sh
fi